%!TEX root = paper.tex
\section{Introduction}
\label{sec:intro}

Bluetooth Low Energy (BLE) is a wireless personal area network (WPAN) technology aimed at novel applications in the healthcare, fitness, beacons, security, and home entertainment industries. Due to substantial reduction in power consumption, BLE becomes a pervasive solution for Internet of Things applications and proximity sensing services like iBeacons in public places. A vast majority of personal devices such as smartphones, smartwatches, fitness trackers and AirPods are sending BLE packets constantly. Beaconing constantly can have multiple privacy consequences. For instance, motion sensors on wrist-worn devices can leak the information about what a user is typing \cite{mole_wang} or BLE traffic of the fitness trackers can be analyzed to determine userâ€™s current activity \cite{mole_wang,fitnesstrackers_pathak}. Moreover, beaconing frequently is equivalent to announcing your presence to a malicious attacker. Detecting presence of a phone can be combined with side information from the world and end up in detecting the presence and tracking a person. Furthermore, identifying devices through BLE protocol can yield a finer-grained location detection and tracking as opposed to WiFi as BLE is a short range communication technology.

To mitigate these privacy threats, most new wireless technologies including BLE protocol, suggest MAC address randomization. BLE protocol suggests changing a device's MAC address to a randomly generated address after a while so that attackers lose the victim's device. Although a study shows that some devices make improper use of randomization by sending wireless frames with the true global address \cite{MACRandomizationfail_Martin}, we show that even if MAC randomization suggested by BLE protocol is perfectly implemented, one can still identify a device through physical-layer fingerprints or radio frequency (RF) fingerprints. RF fingerprinting refers to the techniques which take advantage of hardware imperfections produced during manufacturing and extract unique features related to analog hardware component in the RF chain. As RF fingerprints are embedded in the nature of the hardware, it is hard to hide or mimic these fingerprints. Therefore, they can be used as unique signatures to identify different devices. Moreover, as they are also affected by minor variations in manufacturing prrocess, they can be  even used to identify devices from the same type and manufacturer.

RF fingerprinting has become an interesting possible solution for applications such as authorized access in WiFi access points (AP), RFID transponders, electronic passports, forensics and malfunctioning detection. Mimicking RF fingerprints is hard and requires expensive hardware since these fingerprint are embedded in the underlying hardware. Therefore, they can be used as an additional reliable layer of security for authorization, intrusion detection and impersonation attacks. During the past 15 years, there have been lots of effort in designing algorithms and protocols for building authentication and identification systems based on physical-layer fingerprinting, especially for WiFi technology. These techniques employ signal processing algorithms as well as classical machine learning and new deep learning architectures to extract aforementioned fingerprints in order to identify and classify the devices. However, Danev \textit{et al.} \cite{physicalattack_danev} show that one can attack these RF fingerprinting-based authentication systems using an SDR such as an Universal Software Radio Peripheral (USRP) to generate a signal in order to mimic some of the important hardware signatures including carrier frequency offset (CFO), I/Q imbalance, preamble and transient part of the signal.

Although it might be possible for an attacker to employ an expensive SDR to attack such systems, it is not possible to hide RF fingerprints in a signal sent by personal devices such as smartphone or smartwatches with the current hardware implementation. Therefore, physical-layer fingerprint leakage can cause privacy issues as one can receive RF fingerprints from a device and identify the device. In fact, RF fingerprints that are believed to be helpful in providing additional security, can be used by a malicious attacker to detect the presence of a device and threaten their privacy. 
\begin{comment}
    Moreover, identifying a device will make the tracking of a device possible as one can use multiple high-end receivers and analyze RF fingerprints after removing relative effects of different receivers. 
\end{comment}
Consequently, the attempt of BLE technology in preserving location privacy of devices by randomizing MAC address, fails through physical-layer signatures. In addition, the fact that BLE protocol randomizes the MAC address only after a while and not every packet, helps attackers in building a more reliable profile for each device which eventually ends up in identifying the devices more accurately.

In this paper, we show how an attacker can use signal processing algorithms as well as machine learning techniques to maliciously identify and detect the presence of a device. Specifically, the attacker builds profiles for multiple victims by fingepriting the signals from victim's phone and assigns the device MAC address to a victim by getting close to the victim and using signal strength. After that, the attacker leaves his receiver at a specific place and detects the presence of victims using the obtained profile, even if the MAC address has changed. To obtain such a fingerprinting profile, first of all, we cannot use the existing RF fingerprinting methodologies for WiFi since these techniques benefit from the long enough header of WiFi packet to estimate the hardware imperfections [CITE] while the preamble in BLE packet is only 8 microseconds which is insufficient to estimate the imperfections accurately. Secondly, since the BLE packet length is too short (usually a few hundreds of microsecconds) and it is a narrowband transmission, using FFT will result in a low frequency resolution (because of length) and low frequency range (because of being narrowband), thus insufficient for fingerprinting the device. Third, BLE beacon packets are usually fixed during a MAC address lifetime and they change by changing the MAC address because of whitening. Consequently, commonly we see only one packet from a device during training and completely different packets during the test. Consequently, we found that using FFT or deep learning on the entire packet will overfit the packet shape instead of learning hardware imperfections. Fourth, the only existing works on RF fingerprintg Bluetooth transmitters, utilize the transient portion of the signal and they do not get a decent accuracy [CITE]. This is due to the fact that transient portion of the signal is too short to build a sufficient and robust profile for the device [CITE].\\

As a result, we present a new method for accurately estimating already-known hardware imperfections for short BLE packets. Using these imperfections for RF fingerprintg is well-studied for WiFi packets [CITE]. However, due to the aforementioned reasons, we cannot use the existing techniques for BLE packets. Moreover, we found that in order to reduce energy consumption, many BLE-only devices like fitness trackers use a different architecture which is fundamentally different than other I/Q based architecture. Since, there is no existing methodology to fingerprint this kind of architecture, we propose a new methodology which fingerprintts this kind of architecture robustly. The idea behind both these methologies can be extended to many other communication technologies. In summary, the contribution of this paper is as follows:
\begin{itemize}
\item We present a physical layer attack model for detecting the presence of people through the fequently-sent BLE packets from their devices such as phones, smartwatches, laptops, etc.
\item We propose a new RF fingerpritng technique for estimating hardware imperfections accurately
\item We reveal a new hardware imperfection which is specific to low power devices and we propose a novel method for profiling that
\item We demonstrate the practicality of our attack using the field experiments and collecting a one of a kind dataset in the wild
\end{itemize}

The remainder of this paper is organized as follows. In section 2, we shed lights on importance of the aforementioned privacy issue. A background on BLE technology and physical layer modulation is provided in section 3.
\begin{comment}
A background on RF fingerprinting and previous techniques as well as their limitation for being applied to our problem is presented in section 3. 
\end{comment}
In section 4, we propose our new algorithms and system design for fingerprinting. Finally, an extensive evaluation of our fingerprinting method and attack model including lab experiments, field experiments and attack deployment is presented in section 5.
